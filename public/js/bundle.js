(()=>{var e,t=globalThis,r={},n={},o=t.parcelRequire11c7;null==o&&((o=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return r[e]=o,t.call(o.exports,o,o.exports),o.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){n[e]=t},t.parcelRequire11c7=o);var a=o.register;a("4o2O7",function(t,r){t.exports=o("1SoBz")(function(t){if(t=o.i?.[t]||t,!e)try{throw Error()}catch(n){var r=(""+n.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!r)return"./"+t;e=r[0]}return new URL("./"+t,e).toString()}("3r9rb")).then(()=>o("lFaaq"))}),a("1SoBz",function(e,t){"use strict";e.exports=o("3sOjV")(function(e){return new Promise(function(t,r){if([].concat(document.getElementsByTagName("script")).some(function(t){return t.src===e}))return void t();var n=document.createElement("link");n.href=e,n.rel="preload",n.as="script",document.head.appendChild(n);var o=document.createElement("script");o.async=!0,o.type="text/javascript",o.src=e,o.onerror=function(t){var n=TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));o.onerror=o.onload=null,o.remove(),r(n)},o.onload=function(){o.onerror=o.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(o)})})}),a("3sOjV",function(e,t){"use strict";var r={},n={},o={};e.exports=function(e,t){return function(a){var s=function(e){switch(e){case"preload":return n;case"prefetch":return o;default:return r}}(t);return s[a]?s[a]:s[a]=e.apply(null,arguments).catch(function(e){throw delete s[a],e})}}}),Object.assign(o.i??={},{"3r9rb":"mapbox.js"});let s=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},c=(e,t)=>{s();let r=`<div class="alert alert--${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",r),window.setTimeout(s,5e3)},i=async(e,t)=>{try{let r=await fetch("/api/v1/users/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})}),n=await r.json();"success"===n.status?(c("success","Logged in successfully!"),window.setTimeout(()=>{location.assign("/")},1500)):c("error",n.message)}catch(e){c("error","Something went wrong!")}},u=async()=>{try{let e=await fetch("/api/v1/users/logout",{method:"GET",credentials:"include"}),t=await e.json();"success"===t.status&&location.assign("/")}catch(e){c("error","Error logging out! Try again.")}},d=async(e,t)=>{try{let r="password"===t?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",n=e instanceof FormData,o=await fetch(r,{method:"PATCH",credentials:"include",headers:n?{}:{"Content-Type":"application/json"},body:n?e:JSON.stringify(e)}),a=await o.json();"success"===a.status?c("success",`${t.toUpperCase()} updated successfully!`):c("error",a.message)}catch(e){c("error","Something went wrong!")}},l=document.getElementById("map"),m=document.querySelector(".form--login"),p=document.querySelector(".nav__el--logout"),g=document.querySelector(".form-user-data"),f=document.querySelector(".form-user-password"),y=document.getElementById("book-tour");if(l){let e=JSON.parse(l.dataset.locations);o("4o2O7").then(({displayMap:t})=>{t(e)})}m&&m.addEventListener("submit",e=>{e.preventDefault(),i(document.getElementById("email").value,document.getElementById("password").value)}),p&&p.addEventListener("click",e=>{e.preventDefault(),u()}),g&&g.addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),d(t,"data")}),f&&f.addEventListener("submit",async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";let t=document.getElementById("password-current").value,r=document.getElementById("password").value,n=document.getElementById("password-confirm").value;await d({passwordCurrent:t,password:r,passwordConfirm:n},"password"),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""}),y&&y.addEventListener("click",async e=>{e.target.textContent="Processing...";let t=e.target.dataset.tourId;try{let r=await fetch(`/api/v1/bookings/checkout-session/${t}`),n=await r.json();if("fail"===n.status){c("error",n.message),e.target.textContent="Book tour now!";return}window.location.replace(n.session.url)}catch(t){c("error","Error booking tour"),e.target.textContent="Book tour now!"}})})();